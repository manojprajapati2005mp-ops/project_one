<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather Widget</title>
  <style>
    /* Reset & base */
    :root{
      --card-bg: rgba(255,255,255,0.06);
      --glass: rgba(255,255,255,0.06);
      --glass-2: rgba(255,255,255,0.03);
      --text: #ffffff;
      --muted: rgba(255,255,255,0.8);
      --accent: rgba(255,255,255,0.12);
      --shadow: 0 8px 30px rgba(0,0,0,0.45);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: linear-gradient(180deg,#020617 0%, #06102a 100%);
    }

    /* Full-screen centered layout */
    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      position:relative;
      overflow:hidden;
    }

    /* Animated background layers */
    .bg{
      position:absolute;
      inset:0;
      z-index:0;
      pointer-events:none;
      display:block;
      overflow:hidden;
    }
    .bg .layer{
      position:absolute;
      inset:-20%;
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.02), transparent 10%),
                  radial-gradient(circle at 80% 80%, rgba(255,255,255,0.02), transparent 10%);
      transform: translate3d(0,0,0);
      filter: blur(40px);
      mix-blend-mode: screen;
      animation: float 12s ease-in-out infinite;
      opacity: 0.9;
    }
    .bg .layer:nth-child(2){ animation-duration:18s; transform: rotate(30deg) scale(1.2); filter: blur(60px); }
    .bg .layer::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(45deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0));
    }
    @keyframes float{
      0%{ transform: translateY(-5%) rotate(0);}
      50%{ transform: translateY(5%) rotate(2deg); }
      100%{ transform: translateY(-5%) rotate(0);}
    }

    /* Main card */
    .card{
      position:relative;
      z-index:2;
      width:100%;
      max-width:920px;
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:1px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    }

    /* Left - main weather display */
    .main{
      padding:28px;
      display:flex;
      flex-direction:column;
      gap:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      min-height:260px;
    }

    .header-row{
      display:flex;
      align-items:center;
      gap:12px;
      justify-content:space-between;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo{
      width:48px;height:48px;border-radius:12px;
      display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.03);
      font-weight:700;
    }
    .title{
      font-size:18px;
      font-weight:600;
      letter-spacing:0.2px;
    }
    .subtitle{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }

    /* Search */
    .controls{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .search{
      display:flex;
      align-items:center;
      gap:10px;
      background:var(--glass);
      border-radius:12px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,0.04);
      min-width:220px;
      backdrop-filter: blur(6px);
    }
    .search input{
      border:0;
      outline:0;
      background:transparent;
      color:var(--text);
      font-size:14px;
      width:180px;
    }
    .btn{
      display:inline-grid;
      place-items:center;
      padding:10px 14px;
      border-radius:10px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      cursor:pointer;
      color:var(--text);
      font-weight:600;
      font-size:13px;
    }
    .btn:active{ transform:translateY(1px) }

    /* Weather big display */
    .big{
      display:flex;
      gap:20px;
      align-items:center;
    }
    .icon-wrap{
      width:120px;height:120px;
      background:var(--glass-2);
      border-radius:18px;
      display:grid;
      place-items:center;
      border:1px solid rgba(255,255,255,0.03);
    }
    .icon-wrap img{ width:96px;height:96px; image-rendering:auto; }

    .temp-block{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .temp{
      font-size:56px;
      font-weight:700;
      line-height:1;
      display:flex;
      gap:8px;
      align-items:flex-end;
    }
    .deg{
      font-size:18px;
      color:var(--muted);
      font-weight:600;
      margin-bottom:8px;
    }
    .cond{
      font-size:16px;
      color:var(--muted);
    }

    /* Right - details panel */
    .side{
      padding:24px;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      display:flex;
      flex-direction:column;
      gap:14px;
      min-width:260px;
    }
    .meta{
      display:flex;
      gap:12px;
      justify-content:space-between;
      padding:12px;
      border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      font-size:14px;
    }
    .meta div{ display:flex; flex-direction:column; gap:6px; }
    .meta .label{ font-size:12px; color:var(--muted); }
    .meta .value{ font-weight:700; font-size:16px; }

    .footer{
      margin-top:auto;
      font-size:13px;
      color:var(--muted);
      text-align:center;
    }

    /* loader & error */
    .loader{
      display:inline-block;
      width:18px;height:18px;border-radius:50%;
      border:3px solid rgba(255,255,255,0.08);
      border-top-color: rgba(255,255,255,0.28);
      animation: spin 1s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    .error{
      background:rgba(255,50,50,0.08);
      color:#ffdddd;
      padding:10px;
      border-radius:10px;
      border:1px solid rgba(255,50,50,0.12);
      font-size:13px;
    }

    /* Responsive */
@media (max-width:1024px){
  .card{
    grid-template-columns: 1fr;
    max-width: 760px;
  }
  .main, .side{
    padding: 22px;
  }
  .big{
    flex-direction:row;
  }
}

/* Mobile – below 768px */
@media (max-width:768px){
  body{
    padding: 0;
  }
  .wrap{
    padding: 16px;
  }

  .card{
    grid-template-columns: 1fr;
    width: 100%;
    max-width: 500px;
  }

  .header-row{
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }

  .controls{
    width: 100%;
    justify-content: space-between;
  }

  .search{
    flex: 1;
  }

  .search input{
    width: 100%;
  }

  .btn{
    padding: 10px 12px;
    flex-shrink: 0;
  }

  .big{
    flex-direction: column;
    text-align: center;
    align-items: center;
  }

  .temp{
    font-size: 46px;
  }

  .icon-wrap{
    width: 100px;
    height: 100px;
  }
  .icon-wrap img{
    width: 80px;
    height: 80px;
  }
}

/* Small Mobile – below 480px */
@media (max-width:480px){
  .main{
    padding: 18px;
  }
  .side{
    padding: 18px;
  }

  .title{
    font-size: 16px;
  }
  .subtitle{
    font-size: 11px;
  }

  .temp{
    font-size: 40px;
  }
  .deg{
    font-size: 16px;
  }

  .meta{
    font-size: 13px;
    flex-direction: column;
    gap: 16px;
    text-align: center;
    align-items: center;
  }

  .meta .value{
    font-size: 18px;
  }

  .footer{
    font-size: 12px;
  }
}
  </style>
</head>
<body>
  <div class="wrap" aria-live="polite">
    <div class="bg" id="bg">
      <div class="layer" id="bgLayer1"></div>
      <div class="layer" id="bgLayer2"></div>
    </div>

    <div class="card" role="application" aria-label="Weather application">
      <section class="main" aria-labelledby="mainHeading">
        <div class="header-row">
          <div class="brand" title="Weather widget">
            <div class="logo" aria-hidden="true">W</div>
            <div>
              <div class="title" id="mainHeading">Your Weather</div>
              <div class="subtitle">Enter a city — e.g.,Indore,Dewas</div>
            </div>
          </div>

          <div class="controls" aria-hidden="false">
            <div class="search" role="search" aria-label="Search weather by location">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <input id="locationInput" type="text" inputmode="text" aria-label="Location" placeholder="City or postcode"/>
            </div>
            <button id="searchBtn" class="btn" aria-label="Search weather">Search</button>
          </div>
        </div>

        <div id="messageZone" aria-hidden="true"></div>

        <div class="big" id="weatherPanel" aria-live="polite" aria-atomic="true">
          <div class="icon-wrap" id="iconWrap">
            <!-- icon inserted here -->
            <img id="conditionIcon" src="" alt="" />
          </div>

          <div class="temp-block">
            <div class="temp" id="tempDisplay">
              <span id="tempC">--°C</span>
              <span class="deg" id="tempF">--°F</span>
            </div>
            <div class="cond" id="conditionText">Enter a location and press Search</div>
            <div id="locationText" style="color:var(--muted);font-size:13px"></div>
          </div>
        </div>

      </section>

      <aside class="side" aria-labelledby="detailsHeading">
        <div id="detailsHeader">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div id="localTime" style="font-weight:700">--:--</div>
            <div id="region" style="color:var(--muted);font-size:12px"></div>
          </div>
          <div style="color:var(--muted);font-size:13px;margin-top:6px" id="lastUpdated">Last updated: --</div>
        </div>

        <div class="meta" role="list">
          <div role="listitem">
            <div class="label">Feels like</div>
            <div class="value" id="feelsLike">--°C</div>
          </div>
          <div role="listitem">
            <div class="label">Humidity</div>
            <div class="value" id="humidity">--%</div>
          </div>
        </div>

        <div class="meta">
          <div>
            <div class="label">Wind</div>
            <div class="value" id="wind">-- kph</div>
          </div>
          <div>
            <div class="label">Air Quality (PM2.5)</div>
            <div class="value" id="aqi">--</div>
          </div>
        </div>

        <div id="errorBox" style="display:none" role="alert" class="error"></div>

        <div class="footer" id="credits">
          Powered by <strong>WeatherAPI</strong>. Background responds to weather & temperature.
        </div>
      </aside>
    </div>
  </div>

  <script>
    /*
      Weather widget script
      - Uses the API URL pattern you provided.
      - Replace `API_KEY` variable if you later want to set a different key.
    */
    (function(){
      const API_KEY = '92eacc2229e540a3b0b135505250312'; // provided by you
      const baseURL = 'https://api.weatherapi.com/v1/current.json';

      // Elements
      const input = document.getElementById('locationInput');
      const btn = document.getElementById('searchBtn');
      const icon = document.getElementById('conditionIcon');
      const tempC = document.getElementById('tempC');
      const tempF = document.getElementById('tempF');
      const conditionText = document.getElementById('conditionText');
      const locationText = document.getElementById('locationText');
      const feelsLike = document.getElementById('feelsLike');
      const humidity = document.getElementById('humidity');
      const wind = document.getElementById('wind');
      const aqi = document.getElementById('aqi');
      const localTime = document.getElementById('localTime');
      const region = document.getElementById('region');
      const lastUpdated = document.getElementById('lastUpdated');
      const errorBox = document.getElementById('errorBox');
      const messageZone = document.getElementById('messageZone');
      const bg = document.getElementById('bg');

      // Defaults
      let controller = null;

      // Utility: show error
      function showError(msg){
        errorBox.style.display = 'block';
        errorBox.textContent = msg;
      }
      function clearError(){
        errorBox.style.display = 'none';
        errorBox.textContent = '';
      }

      // Format time nicely from localtime string returned by API (e.g. "2025-12-03 13:45")
      function formatLocalTime(local) {
        try {
          const [date, time] = local.split(' ');
          const d = new Date(local.replace(' ', 'T'));
          return d.toLocaleString(undefined, { hour: 'numeric', minute: '2-digit', hour12: true, weekday: 'short', month: 'short', day: 'numeric' });
        } catch(e){
          return local;
        }
      }

      // Update background visuals based on condition + temp
      function updateBackground(conditionTextStr, temp_c) {
        const cond = conditionTextStr.toLowerCase();
        // determine palette
        let gradientStart = '#0f172a', gradientEnd = '#07112a';
        let accent = 'sunny';

        if(cond.includes('sun') || cond.includes('clear') || cond.includes('sunny')) {
          gradientStart = '#FF8C42';
          gradientEnd = '#FF3D00';
          accent = 'sunny';
        } else if(cond.includes('cloud') || cond.includes('overcast')) {
          gradientStart = '#6B7280';
          gradientEnd = '#111827';
          accent = 'cloudy';
        } else if(cond.includes('rain') || cond.includes('drizzle')) {
          gradientStart = '#3A7BD5';
          gradientEnd = '#00d2ff';
          accent = 'rain';
        } else if(cond.includes('snow') || cond.includes('sleet') || cond.includes('ice')) {
          gradientStart = '#7DE0FF';
          gradientEnd = '#BFE9FF';
          accent = 'snow';
        } else if(cond.includes('thunder') || cond.includes('storm')) {
          gradientStart = '#0f172a';
          gradientEnd = '#1f2937';
          accent = 'storm';
        } else if(cond.includes('mist') || cond.includes('fog') || cond.includes('haze')) {
          gradientStart = '#a0aec0';
          gradientEnd = '#2d3748';
          accent = 'mist';
        } else {
          // fallback by temperature
          if(temp_c >= 25) {
            gradientStart = '#FF7A00';
            gradientEnd = '#FF3D00';
            accent = 'hot';
          } else if(temp_c <= 0) {
            gradientStart = '#63CDF6';
            gradientEnd = '#3AA0D9';
            accent = 'cold';
          } else {
            gradientStart = '#2b6cb0';
            gradientEnd = '#2c3e50';
            accent = 'mild';
          }
        }

        // apply background gradient and subtle motion
        bg.style.background = `linear-gradient(135deg, ${gradientStart}, ${gradientEnd})`;
        // adjust layer brightness & animation according to accent
        const layer1 = document.getElementById('bgLayer1');
        const layer2 = document.getElementById('bgLayer2');

        // different textures per accent
        switch(accent){
          case 'sunny':
            layer1.style.backgroundImage = 'radial-gradient(circle at 10% 20%, rgba(255,255,255,0.08), transparent 8%), radial-gradient(circle at 80% 80%, rgba(255,255,255,0.04), transparent 12%)';
            layer2.style.backgroundImage = 'radial-gradient(circle at 60% 20%, rgba(255,255,255,0.05), transparent 10%)';
            layer1.style.opacity = '0.9';
            layer2.style.opacity = '0.6';
            break;
          case 'rain':
            layer1.style.backgroundImage = 'linear-gradient(180deg, rgba(255,255,255,0.02), transparent)';
            layer2.style.backgroundImage = 'repeating-linear-gradient(45deg, rgba(255,255,255,0.02) 0 2px, transparent 2px 8px)';
            layer1.style.opacity = '0.7';
            layer2.style.opacity = '0.5';
            break;
          case 'cloudy':
            layer1.style.backgroundImage = 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.04), transparent 6%), radial-gradient(circle at 70% 70%, rgba(255,255,255,0.03), transparent 10%)';
            layer1.style.opacity = '0.6';
            layer2.style.opacity = '0.45';
            break;
          case 'snow':
            layer1.style.backgroundImage = 'radial-gradient(circle at 30% 20%, rgba(255,255,255,0.08), transparent 5%)';
            layer1.style.opacity = '0.95';
            layer2.style.opacity = '0.6';
            break;
          case 'storm':
            layer1.style.backgroundImage = 'linear-gradient(180deg, rgba(0,0,0,0.15), transparent)';
            layer1.style.opacity = '0.9';
            layer2.style.opacity = '0.4';
            break;
          default:
            layer1.style.backgroundImage = 'radial-gradient(circle at 20% 20%, rgba(255,255,255,0.03), transparent 8%)';
            layer1.style.opacity = '0.7';
            layer2.style.opacity = '0.5';
            break;
        }

        // tweak animation speed by temperature (subtle)
        const t = Math.max(8, Math.min(24, 16 - Math.round((temp_c - 15) / 2)));
        layer1.style.animationDuration = `${t}s`;
        layer2.style.animationDuration = `${t + 6}s`;
      }

      // Format numbers safely
      function fmt(n, d=0){ return (Math.round((n + Number.EPSILON) * Math.pow(10,d))/Math.pow(10,d)).toFixed(d); }

      // Main fetch
      async function fetchWeather(q) {
        clearError();
        messageZone.innerHTML = '';
        // Abort previous
        if(controller) controller.abort();
        controller = new AbortController();

        // Show loader
        btn.disabled = true;
        btn.innerHTML = '<span class="loader" aria-hidden="true"></span>';
        try {
          const url = `${baseURL}?key=${encodeURIComponent(API_KEY)}&q=${encodeURIComponent(q)}&aqi=yes`;
          const res = await fetch(url, { signal: controller.signal });
          if(!res.ok){
            const txt = await res.text().catch(()=>res.statusText);
            throw new Error('API error: ' + (txt || res.statusText));
          }
          const data = await res.json();

          // Basic validations
          if(!data || !data.current || !data.location) throw new Error('Unexpected API response.');

          // Populate UI
          const c = data.current;
          const loc = data.location;

          // Icon URL from API may be relative (//cdn...), ensure https
          let iconSrc = c.condition.icon || '';
          if(iconSrc && iconSrc.startsWith('//')) iconSrc = 'https:' + iconSrc;
          if(!iconSrc && c.condition && c.condition.text){
            // fallback tiny SVG
            iconSrc = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><rect width="100%" height="100%" fill="%23000000"/></svg>';
          }

          icon.src = iconSrc;
          icon.alt = c.condition.text || 'Weather icon';

          tempC.textContent = fmt(c.temp_c,1) + '°C';
          tempF.textContent = fmt(c.temp_f,1) + '°F';
          conditionText.textContent = c.condition.text || '—';
          locationText.textContent = `${loc.name}, ${loc.region ? loc.region + ', ' : ''}${loc.country}`;
          feelsLike.textContent = fmt(c.feelslike_c,1) + '°C';
          humidity.textContent = (c.humidity ?? '--') + '%';
          wind.textContent = (c.wind_kph ?? '--') + ' kph';
          aqi.textContent = (c.air_quality && c.air_quality.pm2_5) ? fmt(c.air_quality.pm2_5,1) : 'N/A';
          localTime.textContent = formatLocalTime(loc.localtime);
          region.textContent = `${loc.tz_id || ''}`.replace('undefined','');
          lastUpdated.textContent = 'Last updated: ' + (new Date().toLocaleString());
          // Update background according to condition & temp
          updateBackground(c.condition.text || '', c.temp_c || 0);

          // small accessibility announcement
          messageZone.innerHTML = `Showing weather for ${loc.name}. ${c.temp_c} degrees Celsius and ${c.condition.text}.`;
          messageZone.setAttribute('aria-hidden','false');

        } catch(err){
          // handle abort quietly
          if(err.name === 'AbortError') return;
          console.error(err);
          showError(err.message || 'Unable to fetch weather. Check location or API key.');
        } finally {
          btn.disabled = false;
          btn.textContent = 'Search';
        }
      }

      // Event listeners
      btn.addEventListener('click', ()=> {
        const q = input.value.trim();
        if(!q){ showError('Please enter a location.'); return; }
        clearError();
        fetchWeather(q);
      });
      input.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter'){ btn.click(); }
      });

      // On load: Try GPS first, fallback to auto IP
        window.addEventListener('load', () => {
        navigator.geolocation.getCurrentPosition(
        (pos) => {
            // If user allows location
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            fetchWeather(`${lat},${lon}`);
        },
        () => {
            // If user denies GPS or error occurs
            fetchWeather("auto:ip");
        }
    );

});


      // Expose for debugging (optional)
      window.__weatherWidget = { fetchWeather };

    })();
  </script>
</body>
</html>

